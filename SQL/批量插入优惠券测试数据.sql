-- =====================================================
-- 批量插入优惠券测试数据
-- 数据库: Oracle 19c
-- 表名: COUPON_MANAGERS
-- 创建时间: 2025-09-02
-- =====================================================

-- 检查依赖数据是否存在
SELECT '检查商家数据...' AS 状态 FROM DUAL;
SELECT COUNT(*) AS 商家数量 FROM SELLERS WHERE USERID IN (3, 4);

SELECT '检查店铺数据...' AS 状态 FROM DUAL;
SELECT COUNT(*) AS 店铺数量 FROM STORES WHERE STOREID IN (101, 102);

-- 如果依赖数据不存在，请先运行 完整测试数据插入.sql
-- 或者手动插入必要的用户、商家和店铺数据

-- 清理现有测试数据（可选）
-- DELETE FROM COUPON_MANAGERS WHERE COUPONMANAGERID >= 2000;

-- 批量插入优惠券数据
-- 注意：根据表结构，以下字段为必填（NOT NULL）：
-- COUPONMANAGERID, MINIMUMSPEND, DISCOUNTAMOUNT, VALIDFROM, VALIDTO, STOREID

INSERT ALL
    -- 满减券类型 (COUPONTYPE = 0)
    INTO COUPON_MANAGERS (
        COUPONMANAGERID, MINIMUMSPEND, DISCOUNTAMOUNT, VALIDFROM, VALIDTO, STOREID,
        COUPONNAME, COUPONTYPE, DISCOUNTRATE, TOTALQUANTITY, USEDQUANTITY, DESCRIPTION, SELLERID
    ) VALUES (
        2001, 50.00, 10.00, TIMESTAMP '2024-01-01 00:00:00', TIMESTAMP '2024-12-31 23:59:59', 101,
        '新用户满50减10', 0, NULL, 1000, 0, '新用户专享优惠券，满50元减10元', 3
    )
    
    INTO COUPON_MANAGERS (
        COUPONMANAGERID, MINIMUMSPEND, DISCOUNTAMOUNT, VALIDFROM, VALIDTO, STOREID,
        COUPONNAME, COUPONTYPE, DISCOUNTRATE, TOTALQUANTITY, USEDQUANTITY, DESCRIPTION, SELLERID
    ) VALUES (
        2002, 100.00, 20.00, TIMESTAMP '2024-01-01 00:00:00', TIMESTAMP '2024-12-31 23:59:59', 101,
        '满100减20', 0, NULL, 500, 0, '满100元减20元优惠券', 3
    )
    
    INTO COUPON_MANAGERS (
        COUPONMANAGERID, MINIMUMSPEND, DISCOUNTAMOUNT, VALIDFROM, VALIDTO, STOREID,
        COUPONNAME, COUPONTYPE, DISCOUNTRATE, TOTALQUANTITY, USEDQUANTITY, DESCRIPTION, SELLERID
    ) VALUES (
        2003, 200.00, 50.00, TIMESTAMP '2024-01-01 00:00:00', TIMESTAMP '2024-12-31 23:59:59', 101,
        '满200减50', 0, NULL, 200, 0, '满200元减50元大额优惠券', 3
    )
    
    -- 折扣券类型 (COUPONTYPE = 1)
    INTO COUPON_MANAGERS (
        COUPONMANAGERID, MINIMUMSPEND, DISCOUNTAMOUNT, VALIDFROM, VALIDTO, STOREID,
        COUPONNAME, COUPONTYPE, DISCOUNTRATE, TOTALQUANTITY, USEDQUANTITY, DESCRIPTION, SELLERID
    ) VALUES (
        2004, 30.00, 0.00, TIMESTAMP '2024-01-01 00:00:00', TIMESTAMP '2024-12-31 23:59:59', 101,
        '9折优惠券', 1, 0.90, 800, 0, '全场9折优惠，最低消费30元', 3
    )
    
    INTO COUPON_MANAGERS (
        COUPONMANAGERID, MINIMUMSPEND, DISCOUNTAMOUNT, VALIDFROM, VALIDTO, STOREID,
        COUPONNAME, COUPONTYPE, DISCOUNTRATE, TOTALQUANTITY, USEDQUANTITY, DESCRIPTION, SELLERID
    ) VALUES (
        2005, 80.00, 0.00, TIMESTAMP '2024-01-01 00:00:00', TIMESTAMP '2024-12-31 23:59:59', 101,
        '8.5折优惠券', 1, 0.85, 300, 0, '全场8.5折优惠，最低消费80元', 3
    )
    
    -- 限时优惠券
    INTO COUPON_MANAGERS (
        COUPONMANAGERID, MINIMUMSPEND, DISCOUNTAMOUNT, VALIDFROM, VALIDTO, STOREID,
        COUPONNAME, COUPONTYPE, DISCOUNTRATE, TOTALQUANTITY, USEDQUANTITY, DESCRIPTION, SELLERID
    ) VALUES (
        2006, 60.00, 15.00, TIMESTAMP '2024-09-01 00:00:00', TIMESTAMP '2024-09-30 23:59:59', 101,
        '9月限时优惠', 0, NULL, 100, 0, '9月限时优惠券，满60减15', 3
    )
    
    -- 已过期优惠券
    INTO COUPON_MANAGERS (
        COUPONMANAGERID, MINIMUMSPEND, DISCOUNTAMOUNT, VALIDFROM, VALIDTO, STOREID,
        COUPONNAME, COUPONTYPE, DISCOUNTRATE, TOTALQUANTITY, USEDQUANTITY, DESCRIPTION, SELLERID
    ) VALUES (
        2007, 40.00, 8.00, TIMESTAMP '2024-01-01 00:00:00', TIMESTAMP '2024-08-31 23:59:59', 101,
        '8月已过期券', 0, NULL, 200, 50, '8月已过期的优惠券，已使用50张', 3
    )
    
    -- 即将开始的优惠券
    INTO COUPON_MANAGERS (
        COUPONMANAGERID, MINIMUMSPEND, DISCOUNTAMOUNT, VALIDFROM, VALIDTO, STOREID,
        COUPONNAME, COUPONTYPE, DISCOUNTRATE, TOTALQUANTITY, USEDQUANTITY, DESCRIPTION, SELLERID
    ) VALUES (
        2008, 120.00, 30.00, TIMESTAMP '2024-10-01 00:00:00', TIMESTAMP '2024-12-31 23:59:59', 101,
        '国庆节优惠券', 0, NULL, 500, 0, '国庆节期间专用优惠券', 3
    )
    
    -- 不同店铺的优惠券
    INTO COUPON_MANAGERS (
        COUPONMANAGERID, MINIMUMSPEND, DISCOUNTAMOUNT, VALIDFROM, VALIDTO, STOREID,
        COUPONNAME, COUPONTYPE, DISCOUNTRATE, TOTALQUANTITY, USEDQUANTITY, DESCRIPTION, SELLERID
    ) VALUES (
        2009, 25.00, 5.00, TIMESTAMP '2024-01-01 00:00:00', TIMESTAMP '2024-12-31 23:59:59', 102,
        '店铺102满25减5', 0, NULL, 1000, 0, '店铺102专用优惠券', 4
    )
    
    INTO COUPON_MANAGERS (
        COUPONMANAGERID, MINIMUMSPEND, DISCOUNTAMOUNT, VALIDFROM, VALIDTO, STOREID,
        COUPONNAME, COUPONTYPE, DISCOUNTRATE, TOTALQUANTITY, USEDQUANTITY, DESCRIPTION, SELLERID
    ) VALUES (
        2010, 150.00, 0.00, TIMESTAMP '2024-01-01 00:00:00', TIMESTAMP '2024-12-31 23:59:59', 102,
        '店铺102会员8折', 1, 0.80, 200, 0, '店铺102会员专享8折优惠', 4
    )

SELECT * FROM DUAL;

-- 验证插入结果
SELECT 
    COUPONMANAGERID,
    COUPONNAME,
    CASE COUPONTYPE 
        WHEN 0 THEN '满减券' 
        WHEN 1 THEN '折扣券' 
        ELSE '未知类型' 
    END AS 优惠券类型,
    MINIMUMSPEND AS 最低消费,
    DISCOUNTAMOUNT AS 优惠金额,
    DISCOUNTRATE AS 折扣率,
    TOTALQUANTITY AS 总数量,
    USEDQUANTITY AS 已使用,
    VALIDFROM AS 开始时间,
    VALIDTO AS 结束时间,
    STOREID AS 店铺ID,
    SELLERID AS 商家ID
FROM COUPON_MANAGERS 
WHERE COUPONMANAGERID >= 2000 
ORDER BY COUPONMANAGERID;

-- 统计信息
SELECT 
    COUNT(*) AS 总优惠券数量,
    SUM(CASE WHEN COUPONTYPE = 0 THEN 1 ELSE 0 END) AS 满减券数量,
    SUM(CASE WHEN COUPONTYPE = 1 THEN 1 ELSE 0 END) AS 折扣券数量,
    SUM(TOTALQUANTITY) AS 总发放数量,
    SUM(USEDQUANTITY) AS 总使用数量
FROM COUPON_MANAGERS 
WHERE COUPONMANAGERID >= 2000;

COMMIT;
