<template>
  <div v-if="commentStatus && storeInfo && commentList" class="flex flex-col items-center gap-4 w-full mt-5">
    <StorePoints :commentStatus="commentStatus" :storeInfo="storeInfo" class="w-full max-w-3xl" />
    <DetailComments :commentList="commentList" class="w-full max-w-3xl" />
  </div>
  <div v-else class="flex justify-center items-center h-64">
    <i class="fas fa-spinner fa-spin text-3xl text-[#F9771C]"></i>
  </div>
</template>

<script setup lang="ts">
import { useRoute } from 'vue-router'
import { ref, computed, onMounted, watch } from 'vue'

import type { StoreInfo, CommentList, CommentStatus } from '@/api/user'
import { getStoreInfo, getCommentStatus, getCommentList } from '@/api/user'

import StorePoints from '@/components/user/StoreDetail/CommentView/StorePoints.vue'
import DetailComments from '@/components/user/StoreDetail/CommentView/DetailComments.vue'

const route = useRoute();
const storeID = computed(() => route.params.id as string);
const storeInfo = ref<StoreInfo>();
const commentStatus = ref<CommentStatus>();
const commentList = ref<CommentList>();

onMounted(async () => {
  storeInfo.value = await getStoreInfo(storeID.value);
  commentStatus.value = await getCommentStatus(storeID.value);
  commentList.value = await getCommentList(storeID.value);
})

watch(storeID, async (newID, oldID) => {
  if (newID != oldID) {
    storeInfo.value = await getStoreInfo(storeID.value);
    commentStatus.value = await getCommentStatus(storeID.value);
    commentList.value = await getCommentList(storeID.value);
  }
})

</script>